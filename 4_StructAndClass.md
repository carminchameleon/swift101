
# Struct vs Class 성능상의 차이를 메모리 구조와 함께 설명해주세요.

1. 메모리 구조

- 구조체는 값 타입으로 인스턴스가 생성될 때 스택에 저장된다. 모든 데이터가 스택의 프레임에 직접 저장되어 빠르게 쓰고 지워질 수 있습니다. <br>
  복사시 깊은 복사가 이루어집니다.

- 클래스는 참조 타입으로 인스턴스의 데이터는 힙 영역에 저장됩니다. 스택에서는 힙 데이터를 가리키는 참조만 저장되게 됩니다.
  (힙을 스캔하고, 빈 공간을 찾고, 빈 공간에 데이터를 할당하고, 그 주소의 값을 스택에서 바라보게 됩니다.)
  <br> 복사시 얕은 복사가 이루어집니다.<br>
  힙 영역에 데이터가 있기 때문에 강한 순환 참조로 인해 메모리 누수가 일어날 수도 있어 주의가 필요합니다.

2. 메서드 호출

- 구조체는 다이렉트 디스패치 (Static Dispatch) 가 이루어집니다.
  직접 코드의 주소를 가지고 있거나 혹은 코드 자체를 가지고 있는 in line 방식으로 이루어집니다. 컴파일 과정에서 실행해야 할 메서드의 주소가 바로 결정되기 때문에 더 빠르게 동작합니다.

- 클래스는 vTable(virtual function table)을 통해 다이나믹 디스패치 (Dynamic Dispatch)가 이루어집니다.
  런타임에 실제로 호출될 메서드를 결정하고 호출합니다. (이는 상속과 다형성을 지원하지만 성능상 오버헤드가 발생할 수 있습니다.)
  그 과정은 특정 인스턴스의 메서드를 실행하고자 한다면, 그 인스턴스의 실질적인 메모리 공간인 힙으로 갑니다.
  그 힙에는 인스턴스를 만들어낸 틀의 데이터 영역의 주소가 있습니다. 그 데이터 영역으로 간 후에,
  vTable을 통해 메서드가 어떤 것을 가리키고 있는지를 찾아간 후, 코드의 주소를 얻을 수 있습니다.

### 🗝️ Keyword

- 스택, 힙, 메모리 누수, 다이렉트 디스패치, 컴파일타임, vTable, 다이나믹 디스패치